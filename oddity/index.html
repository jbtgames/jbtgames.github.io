<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,maximum-scale=1.0,viewport-fit=cover,user-scalable=no" />
  <title>Oddity — JBTgames</title>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet" />

  <style>
  :root {
    --cream: #F4EBD0;
    --ink: #2C1E1E;
    --taupe: #9C8C7A;
    --accent: #E4572E;
    --success: #22B34B;
    --error: #ef4444;
    --share: #2C1E1E; /* new color for share button */
  }

  * { box-sizing:border-box; margin:0; padding:0; }

  body {
    font-family:'Bungee',sans-serif;
    color:var(--ink);
    background:var(--cream);
    display:flex;
    flex-direction:column;
    height:100dvh;
    text-align:center;
  }

  header, footer { flex-shrink:0; }

  header {
    background:var(--accent);
    display:flex;
    align-items:center;
    justify-content:center;
    height:110px;
  }
  header img.logo { height:80%; width:auto; }

  footer {
    font-size:11px; padding:6px 0; line-height:1.4;
    background:var(--accent);
    color:var(--cream);
  }

  .middle {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;
    align-items: center;
    padding: 10px 20px;
  }

  .sub {
    font-size: clamp(18px, 5vw, 28px);
    font-weight: bold;
    margin-bottom: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #progress { font-size:18px; opacity:0.9; }

  .tilesWrap {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  #options {
    width: 100%;
    max-width: 420px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
  }

  .option {
    display:flex; align-items:center; justify-content:center;
    aspect-ratio:1/1;
    border-radius:14px;
    font-size:22px;
    min-height:120px;
    color:var(--cream);
    font-weight:bold;
    transition:.2s transform;
    cursor:pointer;
    user-select:none;
  }
  .option:active { transform:scale(.95); }

  .option:nth-child(1){background:var(--accent);}
  .option:nth-child(2){background:var(--ink);}
  .option:nth-child(3){background:var(--taupe);}
  .option:nth-child(4){background:#000;}

  .correct { background:var(--success)!important; }
  .wrong { background:var(--error)!important; }

  #overlay, #endScreen {
    position:fixed; inset:0; display:none;
    flex-direction:column; align-items:center; justify-content:center;
    background:rgba(44,30,30,.92); z-index:50; padding:20px;
    color:var(--cream);
  }
  #overlay.show, #endScreen.show { display:flex; }
  #overlay h1 { margin:0 0 12px; font-size:32px; }
  #overlay p { font-size:16px; max-width:300px; }

  #continueBtn {
    margin-top:20px;
    padding:18px 24px;
    border:none; border-radius:14px;
    background:var(--accent);
    color:var(--cream);
    font-size:22px;
    font-weight:bold;
    cursor:pointer;
    width:80%;
    max-width:320px;
  }

  #endIcons { font-size:44px; margin-bottom:8px; }
  #endText { margin:0; font-size:26px; color:var(--accent); }
  #endComment { margin-top:10px; font-size:18px; max-width:320px; }
  #shareBtn {
    display:none; margin-top:16px;
    padding:16px 20px; font-size:20px;
    border:none; border-radius:12px;
    background:var(--share); /* different color */
    color:var(--cream); cursor:pointer;
    width:80%;
    max-width:320px;
  }
  </style>
</head>
<body>
  <header>
    <img src="oddity.png" alt="Oddity Logo" class="logo" />
  </header>

  <div class="middle">
    <div class="titleBlock">
      <div class="sub">FIND THE ODD ONE OUT</div>
      <div id="progress"></div>
    </div>
    <div class="tilesWrap">
      <div id="options"></div>
    </div>
  </div>

  <div id="overlay">
    <h1 id="result"></h1>
    <p id="explanation"></p>
    <button id="continueBtn">Continue</button>
  </div>

  <div id="endScreen">
    <div id="endIcons"></div>
    <h1 id="endText"></h1>
    <p id="endComment"></p>
    <button id="shareBtn">Share</button>
  </div>

  <footer id="footerInfo"></footer>

  <script>
  let todaySet = null;
  let level=0;
  let results=[];

  const options=document.getElementById("options"),
        progressEl=document.getElementById("progress"),
        overlay=document.getElementById("overlay"),
        resultEl=document.getElementById("result"),
        explanationEl=document.getElementById("explanation"),
        continueBtn=document.getElementById("continueBtn"),
        endScreen=document.getElementById("endScreen"),
        endIcons=document.getElementById("endIcons"),
        endText=document.getElementById("endText"),
        endComment=document.getElementById("endComment"),
        shareBtn=document.getElementById("shareBtn"),
        footerInfo=document.getElementById("footerInfo");

  const comments = {
    0:["Utter garbage. Zero. Just quit.","Hopeless. You didn’t even scratch the surface.","That’s 0/3 — embarrassing doesn’t cover it.","Zero. Were you even awake?","Pathetic. This is the bottom of the barrel."],
    1:["1/3… humiliating. Were you asleep?","You clearly guessed and failed.","One correct? That’s laughable.","1/3. That’s all? Weak.","You barely tried. Shameful."],
    2:["Close, but still not good enough.","2/3. Almost there, but not a winner.","Decent effort, still a failure.","So close. Too bad close doesn’t count.","Not terrible, but you still lose."],
    3:["Perfect. Finally, someone competent.","3/3. Brilliant result.","Flawless. That’s how it’s done.","You nailed it. Respect.","Victory. Pure skill."]
  };

  function ymd(){const d=new Date();return d.getFullYear()+String(d.getMonth()+1).padStart(2,"0")+String(d.getDate()).padStart(2,"0");}
  function ymdDash(){const d=new Date();return d.toISOString().split("T")[0];}
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  function renderLevel(){
    progressEl.textContent=`Puzzle ${level+1}/3`;
    options.innerHTML="";
    const pool= level===0 ? todaySet.easy : (level===1?todaySet.medium:todaySet.hard);
    const items=shuffle([...pool.words]);
    items.forEach((w)=>{
      const t=document.createElement("div");
      t.className="option";
      t.textContent=w;
      t.onclick=()=>checkChoice(w,pool,t);
      options.appendChild(t);
    });
  }

  function checkChoice(choice,pool,tile){
    [...options.children].forEach(c=>c.onclick=null);
    if(choice===pool.odd){
      tile.classList.add("correct");
      results.push("✓");
      showFeedback(true,pool.explanation);
    }else{
      tile.classList.add("wrong");
      results.push("✗");
      showFeedback(false,pool.explanation);
    }
  }

  function showFeedback(ok,ex){
    resultEl.textContent=ok?"✓ Correct":"✗ Wrong";
    resultEl.style.color=ok?"var(--success)":"var(--error)";
    explanationEl.textContent=ex;
    continueBtn.style.background=ok?"var(--success)":"var(--error)";
    overlay.classList.add("show");
  }

  continueBtn.onclick=()=>{
    overlay.classList.remove("show");
    if(results[results.length-1]==="✗"){finish(false);}
    else if(++level<3){renderLevel();}
    else{finish(true);}
  };

  function finish(win){
    options.innerHTML="";
    endScreen.classList.add("show");
    endIcons.innerHTML=results.map(r=> r==="✓"
      ? `<span style="color:var(--success)">✓</span>`
      : `<span style="color:var(--error)">✗</span>`).join(" ");
    const score = results.filter(r=>r==="✓").length;
    endText.textContent=win?"You Win!":"Game Over";
    const cList = comments[score];
    const comment = cList[Math.floor(Math.random()*cList.length)];
    endComment.textContent=comment;
    endComment.style.color = score===3 ? "var(--success)" : "var(--error)";
    updateFooter();
    shareBtn.style.display="inline-block";
  }

  shareBtn.onclick=()=>{
    let score = results.filter(r=>r==="✓").length;
    let seed = ymd();
    let date = ymdDash();
    let msg = `ODDITY — JBTgames\nSeed ${seed} (${date})\nScore: ${score}/3`;
    if(navigator.share){navigator.share({title:"ODDITY",text:msg});}
    else{navigator.clipboard.writeText(msg).then(()=>alert("Copied!"));} 
  };

  function updateFooter(){
    footerInfo.innerHTML = `Seed: ${ymd()}<br>Date: ${ymdDash()}<br>JBTgames ©2025`;
  }

  async function boot(){
    updateFooter();
    try {
      const res = await fetch("./puzzles.json", { cache: "no-cache" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const all = await res.json();

      const startDate = new Date("2025-10-01"); // first puzzle date
      const today = new Date();
      const daysSinceStart = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));

      // group puzzles by difficulty from new format
      const easy = all.filter(p=>p.difficulty==="easy")[daysSinceStart];
      const medium = all.filter(p=>p.difficulty==="medium")[daysSinceStart];
      const hard = all.filter(p=>p.difficulty==="hard")[daysSinceStart];

      if (!easy || !medium || !hard) {
        document.getElementById("options").innerHTML = "<p>✅ No more puzzles today. Come back tomorrow!</p>";
        return;
      }

      todaySet = { easy, medium, hard };
      renderLevel();
    } catch(e){
      console.error("Puzzle load error:", e);
      document.getElementById("options").innerHTML="<p>❌ Could not load puzzles.json</p>";
    }
  }

  boot();
  </script>
</body>
</html>
